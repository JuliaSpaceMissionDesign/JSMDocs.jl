<!DOCTYPE html><HTML lang="en"><head><script charset="utf-8" src="../../../../../assets/default/multidoc_injector.js" type="text/javascript"></script><script charset="utf-8" type="text/javascript">window.MULTIDOCUMENTER_ROOT_PATH = '/'</script><script charset="utf-8" src="../../../../../assets/default/flexsearch.bundle.js" type="text/javascript"></script><script charset="utf-8" src="../../../../../assets/default/flexsearch_integration.js" type="text/javascript"></script><script charset="utf-8" src="https://www.googletagmanager.com/gtag/js?id=G-K7LNGMSXLE" type="text/javascript"></script><script charset="utf-8" type="text/javascript">window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-K7LNGMSXLE');
</script><meta charset="UTF-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>Spherical Harmonics · JSMD Documentation</title><meta content="Spherical Harmonics · JSMD Documentation" name="title"/><meta content="Spherical Harmonics · JSMD Documentation" property="og:title"/><meta content="Spherical Harmonics · JSMD Documentation" property="twitter:title"/><meta content="Documentation for JSMD Documentation." name="description"/><meta content="Documentation for JSMD Documentation." property="og:description"/><meta content="Documentation for JSMD Documentation." property="twitter:description"/><script data-outdated-warner="" src="../../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../../.."</script><script data-main="../../../../assets/documenter.js" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script><script src="../../../../search_index.js"></script><script src="../../../../siteinfo.js"></script><script src="../../../../../versions.js"></script><link class="docs-theme-link" data-theme-name="catppuccin-mocha" href="../../../../assets/themes/catppuccin-mocha.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="catppuccin-macchiato" href="../../../../assets/themes/catppuccin-macchiato.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="catppuccin-frappe" href="../../../../assets/themes/catppuccin-frappe.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="catppuccin-latte" href="../../../../assets/themes/catppuccin-latte.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="documenter-dark" data-theme-primary-dark="" href="../../../../assets/themes/documenter-dark.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="documenter-light" data-theme-primary="" href="../../../../assets/themes/documenter-light.css" rel="stylesheet" type="text/css"/><script src="../../../../assets/themeswap.js"></script><script src="../../../../assets/init.js"></script><link href="../../../../../assets/default/multidoc.css" rel="stylesheet" type="text/css"/><link href="../../../../../assets/default/flexsearch.css" rel="stylesheet" type="text/css"/></head><body><nav id="multi-page-nav"><div class="hidden-on-mobile" id="nav-items"><a class="nav-link active nav-item" href="../../../../">Home</a><div class="nav-dropdown"><button class="nav-item dropdown-label">Core</button><ul class="nav-dropdown-container"><a class="nav-link nav-item" href="../../../../../Tempo/">Tempo</a><a class="nav-link nav-item" href="../../../../../Ephemerides/">Ephemerides</a><a class="nav-link nav-item" href="../../../../../CalcephEphemeris/">CalcephEphemeris</a><a class="nav-link nav-item" href="../../../../../IERSConventions/">IERSConventions</a><a class="nav-link nav-item" href="../../../../../FrameTransformations/">FrameTransformations</a></ul></div><div class="nav-dropdown"><button class="nav-item dropdown-label">Astro</button><ul class="nav-dropdown-container"><a class="nav-link nav-item" href="../../../../../AstroRepresentations/">AstroRepresentations</a></ul></div><div class="nav-dropdown"><button class="nav-item dropdown-label">Developer Tools</button><ul class="nav-dropdown-container"><a class="nav-link nav-item" href="../../../../../JSMDInterfaces/">JSMDInterfaces</a><a class="nav-link nav-item" href="../../../../../JSMDUtils/">JSMDUtils</a><a class="nav-link nav-item" href="../../../../../SMDGraphs/">SMDGraphs</a></ul></div><div class="search nav-item"><input id="search-input" placeholder="Search..."/><ul class="suggestions hidden" id="search-result-container"></ul><div class="search-keybinding">/</div></div></div><button id="multidoc-toggler"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg></button></nav><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../../"><img alt="JSMD Documentation logo" src="../../../../assets/logo.png"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../../">JSMD Documentation</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../../">Welcome to Julia Space Missions Design!</a></li><li><span class="tocitem">Ecosystem</span><ul><li><a class="tocitem" href="../../../../ecosystem/mission/">Mission</a></li></ul></li><li><span class="tocitem">Encyclopedia</span><ul><li><input checked="" class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Models</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input checked="" class="collapse-toggle" id="menuitem-3-1-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1-1"><span class="docs-label">Gravity</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../intro/">Introduction</a></li><li><a class="tocitem" href="../point/">Point Masses</a></li><li class="is-active"><a class="tocitem" href="">Spherical Harmonics</a><ul class="internal"><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#Algorithmic-implementation"><span>Algorithmic implementation</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li></ul></li></ul></li><li><a class="tocitem" href="../../../../references/">References</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" href="#" id="documenter-sidebar-button"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Encyclopedia</a></li><li><a class="is-disabled">Models</a></li><li><a class="is-disabled">Gravity</a></li><li class="is-active"><a href="">Spherical Harmonics</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="">Spherical Harmonics</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaSpaceMissionDesign/JSMDocs.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaSpaceMissionDesign/JSMDocs.jl/blob/master/docs/src/encyclopedia/astro/gravity/harmonics.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" href="#" id="documenter-settings-button" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" href="javascript:;" id="documenter-article-toggle-button" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Spherical-Harmonics"><a class="docs-heading-anchor" href="#Spherical-Harmonics">Spherical Harmonics</a><a id="Spherical-Harmonics-1"></a><a class="docs-heading-anchor-permalink" href="#Spherical-Harmonics" title="Permalink"></a></h1><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>A possibile way to represent the exterior gravitational field of non-spherical objects is  by exploiting a spherical harmonics expansion of its field. </p><p class="math-container">\[\begin{equation}
    U = \frac{\mu}{R}\sum_{n=0}^\infty\sum_{m=0}^n \left(\frac{R}{r}\right)^{n+1}\left(\bar{C}_{nm}\cos(m\lambda) + \bar{S}_{nm}\sin(m\lambda)\right)\,\bar{P}_{nm}(\sin\varphi)
\end{equation}\]</p><p>with dimensionless coefficients <span>$\bar{C}_{nm}$</span> and <span>$\bar{S}_{nm}$</span>, <span>$R$</span> the semimajor  axis of the reference ellipsoid belonging to the model, <span>$\mu$</span> the gravitational parameter  and <span>$\bar{P}_{nm}$</span> the fully normalized associated Legendre polynomials of degree <span>$n$</span> and order <span>$m$</span>. Here the normalization is performed using the following expression, as for [<a href="../../../../references/#kaula2013">1</a>]:</p><p class="math-container">\[\begin{equation}
    N_{nm} = \sqrt{\frac{(2n+1)(n-m)!(2-\delta_{m0})}{(n+m)!}}
\end{equation}\]</p><p>such that </p><p class="math-container">\[\begin{equation*}
    \bar{P}_{nm} = N_{nm} \, P_{nm}, \qquad \bar{C}_{nm} = \cfrac{C_{nm}}{N_{nm}}
\end{equation*}\]</p><p>Denoting the cartesian coordinates of the satellite position <span>$(x,y,z)$</span> in the body  frame of the body, their relation with the spherical coordinates used here are:</p><p class="math-container">\[\begin{align*}
    x &amp;= r\cos\varphi\cos\lambda \\
    y &amp;= r\cos\varphi\sin\lambda \\
    z &amp;= r\sin\varphi
\end{align*}\]</p><p>where here <span>$r\geq 0$</span>, <span>$\varphi\in [-\pi/2, \pi/2]$</span> and <span>$\lambda\in[0, 2\pi]$</span>. In the literature  instead of <span>$\varphi$</span>, mostly the <strong>colatitude</strong><span>$\vartheta=\pi/2-\varphi$</span> is used. Here  the <strong>latitude</strong> is preferred because its domain coincides with the range of the inverse  trigonometric functions <code>arcsin</code> and most notably <code>arctan</code>.</p><h2 id="Algorithmic-implementation"><a class="docs-heading-anchor" href="#Algorithmic-implementation">Algorithmic implementation</a><a id="Algorithmic-implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Algorithmic-implementation" title="Permalink"></a></h2><p>While Eq. 1 is the standard format of a spherical harmonics expansion, algorithmic implementation takes advantages of the recurrence relations for Legendre polynomials as well as for the computation of <span>$\sin m\lambda$</span> and <span>$\cos m\lambda$</span>.</p><p>This allows an efficient computation of the geopotential and the resulting acceleration as a function of the cartesian coordinates of the satellite.</p><h3 id="Recurrence-relations"><a class="docs-heading-anchor" href="#Recurrence-relations">Recurrence relations</a><a id="Recurrence-relations-1"></a><a class="docs-heading-anchor-permalink" href="#Recurrence-relations" title="Permalink"></a></h3><p>According to [<a href="../../../../references/#cunningham1970">2</a>, <a href="../../../../references/#montenbruck">3</a>], defining:</p><p class="math-container">\[\begin{align*}
    V_{nm} &amp;= \left(\frac{R}{r}\right)^{n+1} P_{nm}(\sin\varphi) \cos m\lambda \\
    W_{nm} &amp;= \left(\frac{R}{r}\right)^{n+1} P_{nm}(\sin\varphi) \cos m\lambda 
\end{align*}\]</p><p>Such that:</p><p class="math-container">\[\begin{equation}
    U = \frac{\mu}{R}\sum_{n=0}^\infty\sum_{m=0}^n \, C_{nm}V_{nm} + S_{nm}W_{nm}
\end{equation}\]</p><p>and using some Legendre polynomials recurrence relations [<a href="../../../../references/#montenbruck">3</a>], <span>$V_{nm}$</span> and <span>$W_{nm}$</span> may be expressed by the following recurrence relationships:</p><p class="math-container">\[\begin{align*}
    V_{nn} &amp;= (2n-1)\bigg(X V_{n-1,n-1} - Y W_{n-1, n-1} \bigg) \\
    W_{nn} &amp;= (2n-1)\bigg(X W_{n-1,n-1} + Y V_{n-1, n-1} \bigg) \\
\end{align*}\]</p><p>and </p><p class="math-container">\[\begin{align*}
    V_{nm} &amp;= \left(\cfrac{2n-1}{n-m}\right) \, Z V_{n-1,m} - \left(\cfrac{n+m-1}{n-m}\right) \, \bar{R} V_{n-2,m}\\
    W_{nn} &amp;= \left(\cfrac{2n-1}{n-m}\right) \, Z W_{n-1,m} - \left(\cfrac{n+m-1}{n-m}\right) \, \bar{R} W_{n-2,m} \\
\end{align*}\]</p><p>starting from</p><p class="math-container">\[\begin{equation*}
    V_{00} = \frac{R}{r}, \qquad W_{00} = 0
\end{equation*}\]</p><p>where </p><p class="math-container">\[    X = \cfrac{xR}{r^2}, \qquad
    Y = \cfrac{yR}{r^2}, \qquad
    Z = \cfrac{zR}{r^2}, \qquad
    \bar{R} = \cfrac{R^2}{r^2}\]</p><p>With this approach, in order to compute all <span>$V_{nm}$</span> and <span>$W_{nm}$</span> with <span>$0\leq m \leq n \leq N$</span>,  first the zonal terms must be computed with <span>$V_{n0}$</span> recurrence. The corresponding values  of <span>$W_{n0}$</span> are all identical to zero. Once the zonal terms are compute, the tesseral terms can  be computed using the recurence relations for <span>$V_{nn}$</span> and <span>$W_{nn}$</span>. Finally, the other  terms can be computed using the recurence relations for <span>$V_{nm}$</span> and <span>$W_{nm}$</span>.</p><h3 id="Normalization-recurrences"><a class="docs-heading-anchor" href="#Normalization-recurrences">Normalization recurrences</a><a id="Normalization-recurrences-1"></a><a class="docs-heading-anchor-permalink" href="#Normalization-recurrences" title="Permalink"></a></h3><p>In analogy to the recurrence pattern used for <span>$V_{nm}$</span> and <span>$W_{nm}$</span>, a recurrence pattern for  the normalization factor is build. The recurrence pattern follow the same of the factors, thus a  recurrence for zonal, tesseral and sectorial terms is needed.</p><p>For zonal case, since Eq. 2 simplifies, no recurrence is used:</p><p class="math-container">\[    N_{n0} = \sqrt{(2n+1)},\, \quad n=0,...,N\]</p><p>For the tesseral terms:</p><p class="math-container">\[    N_{n+1, n+1} = \sqrt{ \frac{2n+1}{(2n)(2n-1)^2} \, \frac{2-\delta_{n, 0}}{2-\delta_{n-1,0}} } \, N_{n, n}, \, \quad n=1,...,N\]</p><p>And, finally, for the sectorial:</p><p class="math-container">\[    N_{n, m+1} = \sqrt{ \frac{1}{(n-m)(n+m+1)(2-\delta_{m0})} } \, N_{n, m}, \, \quad n=2,...,N\]</p><h3 id="Recurrences-stability"><a class="docs-heading-anchor" href="#Recurrences-stability">Recurrences stability</a><a id="Recurrences-stability-1"></a><a class="docs-heading-anchor-permalink" href="#Recurrences-stability" title="Permalink"></a></h3><p>The recursions presented here are stable, which means that small numerical errors in the  computation of low-order terms do not lead to meaningless results for high orders.  In the following figure, the computation of <span>$V_{nm}$</span> is perfomed with <code>Float64</code> and <code>Float128</code>  and the relative logarithmic error is shown as a measure of the recurrence stability.  In particular, the following quantity is computed and shown:</p><p class="math-container">\[\begin{equation*}
    \delta V_{nm} = 18 + \log_{10} \bigg|\frac{V_{nm}^{128} - V_{nm}^{64}}{V_{nm}^{128}} \bigg|
\end{equation*}\]</p><p>Note that this is directly the number of digits different from <code>Float128</code>, which has 18 digits.  </p><div align="center"><img alt="Image" src="assets/delta_Vnm_float128.png"/></div><p>Similar results are obtained for <span>$W_{nm}$</span>. As a rule of thumb, one can expect to loose 2-3, 4-5, and 5-6 digits when evaluating these  functions up to orders 15, 50, and 100, respectively.</p><p>Equivalently, the same error analysis is performed for the normalization factors recurrences, resulting in the following <span>$\delta N_{nm}$</span> relative error:</p><div align="center"><img alt="Image" src="assets/delta_Nnm_float128.png"/></div><h3 id="Acceleration-computation"><a class="docs-heading-anchor" href="#Acceleration-computation">Acceleration computation</a><a id="Acceleration-computation-1"></a><a class="docs-heading-anchor-permalink" href="#Acceleration-computation" title="Permalink"></a></h3><p>The acceleration can be directly computed using the <span>$V_{nm}$</span> and <span>$W_{nm}$</span> factors [<a href="../../../../references/#cunningham1970">2</a>, <a href="../../../../references/#montenbruck">3</a>] as:</p><p class="math-container">\[\ddot{x} = \frac{\mu}{R^2}\sum_{n,m}\ddot{x}_{nm}, \quad \ddot{y} = \frac{\mu}{R^2}\sum_{n,m}\ddot{y}_{nm}, \quad \ddot{z} = \frac{\mu}{R^2}\sum_{n,m}\ddot{z}_{nm}\]</p><p>with partial accelerations, using normalized quantities:</p><p class="math-container">\[\begin{align*}
    \ddot{x}_{nm} &amp;\overset{(\mathrm{m=0})}{=} \eta_n \left( -\bar{C}_{n0} \bar{V}_{n+1,1} \right) \\
                  &amp;\overset{(\mathrm{m&gt;0})}{=} \xi_{n,m} \left( -\bar{C}_{nm} \bar{V}_{n+1,m+1} -\bar{S}_{nm} \bar{W}_{n+1,m+1} \right) + \chi_{n,m} \left( \bar{C}_{nm} \bar{V}_{n+1,m-1} +\bar{S}_{nm} \bar{W}_{n+1,m-1} \right) \\ 
    \ddot{y}_{nm} &amp;\overset{(\mathrm{m=0})}{=} \eta_n \left( -\bar{C}_{n0} \bar{W}_{n+1,1} \right) \\
                  &amp;\overset{(\mathrm{m&gt;0})}{=} \xi_{n,m} \left( -\bar{C}_{nm} \bar{W}_{n+1,m+1} +\bar{S}_{nm} \bar{V}_{n+1,m+1} \right) + \chi_{n,m} \left( -\bar{C}_{nm} \bar{W}_{n+1,m-1} +\bar{S}_{nm} \bar{V}_{n+1,m-1} \right) \\
    \ddot{z}_{nm}  &amp;= \beta_{n,m} \left( -\bar{C}_{nm} \bar{V}_{n+1,m} -\bar{S}_{nm} \bar{W}_{n+1,m} \right)
\end{align*}\]</p><p>here the following coeffients are introduced: </p><p class="math-container">\[\begin{align*}
    \eta_n &amp;= \frac{N_{n0}}{N_{n+1,1}} = F_{n,0,n+1,1} \\
    \xi_{nm} &amp;= \frac{1}{2}\, \frac{N_{nm}}{N_{n+1,m+1}} = \frac{1}{2} \,F_{n,m,n+1,m+1}\\ 
    \chi_{nm} &amp;= \frac{1}{2}(n-m+2)(n-m+1)\,\frac{N_{nm}}{N_{n+1,m-1}} = \frac{1}{2}(n-m+2)(n-m+1)\, F_{n,m,n+1,m-1} \\ 
    \beta_{nm} &amp;= (n-m+1)\,\frac{N_{nm}}{N_{n+1,m}} = (n-m+1)\,F_{n,m,n+1,m}
\end{align*}\]</p><p>where we have define <span>$F_{n,m,p,q}$</span> as the normalization factor ratio.</p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><ul><li>[<a href="../../../../references/#kaula2013">1</a>] Kaula, Courier Corporation (2013).</li><li>[<a href="../../../../references/#cunningham1970">2</a>] Cunningham, Celestial Mechanics (1970).</li><li>[<a href="../../../../references/#montenbruck">3</a>] Montenbruck, Springer (2000).</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../point/">« Point Masses</a><a class="docs-footer-nextpage" href="../../../../references/">References »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label></p><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div><p></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Friday 11 October 2024 12:37">Friday 11 October 2024</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></HTML>